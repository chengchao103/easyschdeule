var TB=TB||{};(function(){TB.app=TB.app||{};TB.app.login=TB.app.login||{};var win=window,doc=document,decode=decodeURIComponent,ua=navigator.userAgent.toLowerCase(),ie=/msie/.test(ua)&&!/opera/.test(ua),ie6=/msie 6/.test(ua),chrome=/chrome/i.test(ua)&&/webkit/i.test(ua)&&/mozilla/i.test(ua),get=function(id){return typeof(id)!=="string"?id:doc.getElementById(id)};var setHash=function(){try{if(parent&&parent!==self){var docEl=document.documentElement?document.documentElement:document.body;var realHeight=Math.max(docEl.scrollHeight,docEl.clientHeight);doc.location.hash=realHeight}}catch(e){}};if(!Array.prototype.forEach){Array.prototype.forEach=function(fun){var len=this.length;if(typeof fun!="function"){throw new TypeError()}var thisp=arguments[1];for(var i=0;i<len;i++){if(i in this){fun.call(thisp,this[i],i,this)}}}}if(!String.prototype.trim){String.prototype.trim=function(){var re=/^\s+|\s+$/g;return function(){return this.replace(re,"")}}()}var Util=TB.app.login.Util={getElementsByClassName:function(className,tag,root){var ret=[],els=(get(root)||doc).getElementsByTagName(tag||"*"),reg=new RegExp("(^| )"+className+"( |$)","i");for(var i=0,l=els.length;i<l;i++){if(reg.test(els[i].className)){ret.push(els[i])}}return ret},hasClass:function(el,className){el=get(el);if(!className||!el.className){return false}return(" "+el.className+" ").indexOf(" "+className+" ")>-1},addClass:function(el,className){if(!className){return}el=get(el);if(this.hasClass(el,className)){return}el.className+=" "+className},removeClass:function(el,className){el=get(el);if(!this.hasClass(el,className)){return}el.className=(" "+el.className+" ").replace(" "+className+" "," ");if(this.hasClass(el,className)){this.removeClass(el,className)}},addEvent:function(){if(win.addEventListener){return function(el,type,fn,capture){if(!get(el)){return}get(el).addEventListener(type,fn,!!capture)}}else{if(win.attachEvent){return function(el,type,fn){if(el===null){return}var obj=typeof(el)==="string"?get(el):el;if(!obj){return}obj.attachEvent("on"+type,fn)}}}}(),removeEvent:function(){if(win.removeEventListener){return function(el,type,fn,capture){el.removeEventListener(type,fn,!!capture)}}else{if(win.detachEvent){return function(el,type,fn){el.detachEvent("on"+type,fn)}}}}(),preventEvent:function(ev){if(ev.preventDefault){ev.preventDefault()}else{ev.returnValue=false}},onReady:function(callback){if(ie){var timer=setInterval(function(){try{doc.documentElement.doScroll("left");clearInterval(timer);callback()}catch(ex){}},50)}else{window.addEventListener("load",callback,false)}},toParamString:function(obj){var result=[];for(var key in obj){result.push(encodeURIComponent(key)+"="+encodeURIComponent(obj[key]))}return result.join("&")},merge:function(){var o={},a=arguments,l=a.length,i;for(i=0;i<l;i=i+1){for(var p in a[i]){o[p]=a[i][p]}}return o},asyncRequest:function(method,url,callback,data){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest()}else{var MSXML=["MSXML2.XMLHTTP.3.0","Microsoft.XMLHTTP"];for(var i=0;i<MSXML.length;i++){try{xmlhttp=new ActiveXObject(MSXML[i]);break}catch(ex){}}}if(!xmlhttp){return}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){if(xmlhttp.status==200||xmlhttp.status==0){if(callback&&callback.success){callback.success(xmlhttp)}}else{if(callback&&callback.failure){callback.failure(xmlhttp)}}}};method=method.toUpperCase();if(method.toUpperCase()=="GET"&&data&&data.length>0){url+=((url.indexOf("?")==-1)?"?":"&")+data}if(callback&&callback.cache===false){url+=((url.indexOf("?")==-1)?"?":"&")+"rnd="+new Date().valueOf().toString()}xmlhttp.open(method,url);if(method=="POST"){xmlhttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xmlhttp.send(data)}else{xmlhttp.send(null)}}};TB.widget=TB.widget||{};TB.widget.InputHint=new function(){var defConfig={hintMessage:"",hintClass:"tb-input-hint",appearOnce:false};var EMPTY_PATTERN=/^\s*$/;this.decorate=function(inputField,config){inputField=get(inputField);config=Util.merge(defConfig,config||{});var hintMessage=config.hintMessage||inputField.title;var handle={};handle.disabled=false;var focusHandler=function(ev){if(!handle.disabled){handle.disappear()}};var blurHandler=function(ev){if(!handle.disabled){handle.appear()}};handle.disappear=function(){if(hintMessage==inputField.value){inputField.value="";Util.removeClass(inputField,config.hintClass)}};handle.appear=function(){if(EMPTY_PATTERN.test(inputField.value)||hintMessage==inputField.value){Util.addClass(inputField,config.hintClass);inputField.value=hintMessage}};handle.purge=function(){this.disappear();Util.removeEvent(inputField,"focus",focusHandler);Util.removeEvent(inputField,"drop",focusHandler);Util.removeEvent(inputField,"blur",blurHandler)};if(!inputField.title){inputField.setAttribute("title",hintMessage)}Util.addEvent(inputField,"focus",focusHandler);Util.addEvent(inputField,"drop",focusHandler);if(!config.appearOnce){Util.addEvent(inputField,"blur",blurHandler)}handle.appear();return handle}};var setStyle=function(el,property,value){el=get(el);if(!el){return}el.style[property]=value};TB.app.login.Message={show:function(html,type){var wrap=get("J_Message");if(!wrap){return}var el=wrap.getElementsByTagName("p")[0];if(!el){return}el.className=type||"error";el.innerHTML=html;wrap.style.display="";setHash()},hide:function(){var wrap=get("J_Message");if(!wrap){return}wrap.style.display="none";setHash()},_highlighted:[],highlight:function(textBox){Util.addClass(textBox,"highlight");this._highlighted.push(textBox)},clearHighlights:function(){try{this._highlighted.forEach(function(textBox){Util.removeClass(textBox,"highlight")})}catch(err){}this._highlighted.length=0},reset:function(){this.hide();this.clearHighlights()}};TB.app.login.PluginPopup={_init:function(){if(this._el){return}this._el=get("J_PluginPopup");this._mask=document.createElement("div");this._mask.className="popup-mask";this._mask.style.display="none";this._el.parentNode.insertBefore(this._mask,this._el);if(ie6){this._shim=document.createElement("iframe");this._shim.className="popup-shim";this._shim.style.display="none";this._mask.parentNode.insertBefore(this._shim,this._mask)}var instance=this;Util.getElementsByClassName("J_Close",null,this._el).forEach(function(el){Util.addEvent(el,"click",function(){instance.hide()})});Util.addEvent(window,"resize",function(){instance.adjustMask()})},adjustMask:function(){if(this._hidden){return}var instance=this;setTimeout(function(){var w=Math.max(document.documentElement.clientWidth,document.documentElement.scrollWidth)+"px",h=Math.max(document.documentElement.clientHeight,document.documentElement.scrollHeight)+"px";instance._mask.style.width=w;instance._mask.style.height=h;instance._mask.style.display="";if(ie6){instance._shim.style.width=w;instance._shim.style.height=h;instance._shim.style.display=""}},0)},_hidden:true,show:function(){this._init();this._el.style.display="";this._hidden=false;this.adjustMask()},hide:function(){this._init();this._el.style.display="none";this._hidden=true;this._mask.style.display="none";if(this._shim){this._shim.style.display="none"}}};var attachCapsLockTip=function(textPwd,tipEl){Util.addEvent(textPwd,"keypress",function(e){var keyCode=e.keyCode||e.which;var isShift=e.shiftKey||(keyCode==16)||false;if(((keyCode>=65&&keyCode<=90)&&!isShift)||((keyCode>=97&&keyCode<=122)&&isShift)){setStyle(tipEl,"display","")}else{setStyle(tipEl,"display","none")}setHash()})};var submitLoading=function(form){var submitBtn=Util.getElementsByClassName("J_Submit","button",form)[0];Util.addClass(submitBtn.parentNode,"submit-loading")};TB.app.login.AliEdit={isSupportSafePlugin:function(){var aliedit=null;if(window.ActiveXObject){try{aliedit=new ActiveXObject("Aliedit.EditCtrl")}catch(er){return false}}else{aliedit=navigator.plugins["Alipay security control"]||navigator.plugins["Aliedit Plug-In"]||navigator.plugins.Aliedit||null}return aliedit?true:false}};TB.app.login.Page={cfg:{dynamicPasswordUrl:"request_dynamic_password.do"},safePluginSupport:false,_safeMode:false,clearChromePwd:function(){if(chrome){var TplPwd=this._staticForm.elements.TPL_password;setTimeout(function(){TplPwd.value=""},0)}},switchToSafe:function(){if(this.safePluginSupport&&get("Password_Edit_IE")){setStyle("J_StandardPwd","display","none");setStyle("J_PasswordEdit","display","");this._optionSafe.checked=true;this._safeMode=true;this._staticForm.elements.loginType.value=4;this.clearChromePwd();var userName=this._staticForm.elements.TPL_username;if(userName.value!==userName.getAttribute("title")&&userName.value.length){try{this._pwdEdit.focus()}catch(e){}}}else{this.switchToStandard();TB.app.login.PluginPopup.show()}},switchToStandard:function(){setStyle("J_PasswordEdit","display","none");setStyle("J_StandardPwd","display","");setStyle("J_CapsLockTip","display","none");this._optionSafe.checked=false;this._safeMode=false;this._staticForm.elements.loginType.value=3;var userName=this._staticForm.elements.TPL_username;if(userName.value!==userName.getAttribute("title")&&userName.value.length){try{this._staticForm.elements.TPL_password.focus()}catch(e){}}setHash()},_checkStaticForm:function(){var form=this._staticForm,textUserName=form.elements.TPL_username,textPassword=form.elements.TPL_password;TB.app.login.Message.clearHighlights();var s="\u8bf7\u8f93\u5165\u60a8\u7684",msg=s;if(textUserName.value==""||textUserName.value==textUserName.title){msg+="\u8d26\u6237\u540d";TB.app.login.Message.highlight(textUserName);textUserName.focus()}if(this._safeMode){try{this._pwdEdit.EchoTest();textPassword.setAttribute("maxlength",null);var data=textPassword.value=this._pwdEdit.TextData;form.elements.tid.value=this._pwdEdit.ci1();if(data==""){if(msg==s){msg+="\u5bc6\u7801";try{this._pwdEdit.focus()}catch(e){}}else{msg+="\u548c\u5bc6\u7801"}}}catch(err){msg="\u8bf7\u60a8\u5b89\u88c5\u5b89\u5168\u63a7\u4ef6\u540e\uff0c\u518d\u5c1d\u8bd5\u767b\u5f55\u3002"}}else{var pwdEditTmp=get("Password_Edit_Tmp");try{pwdEditTmp.EchoTest();form.elements.tid.value=pwdEditTmp.ci1()}catch(err){}if(textPassword.value==""){TB.app.login.Message.highlight(textPassword);if(msg==s){msg+="\u5bc6\u7801";try{textPassword.focus()}catch(e){}}else{msg+="\u548c\u5bc6\u7801"}}else{form.elements.pstrong.value=PwdIntensity(textPassword.value)}}if(msg==s){TB.app.login.Message.hide();submitLoading(form);return true}else{TB.app.login.Message.show(msg);return false}},_checkDynamicForm:function(){var form=this._dynamicForm,mobilePhone=form.elements.TPL_mobilephone;textPhoneCode=form.elements.TPL_PhoneCode;TB.app.login.Message.clearHighlights();var s="\u8bf7\u8f93\u5165\u60a8\u7684",msg=s;if(mobilePhone.value.trim()==""){msg+="\u624b\u673a";TB.app.login.Message.highlight(mobilePhone);mobilePhone.focus();TB.app.login.Message.show(msg);return false}if(!/^\d+$/g.test(mobilePhone.value.trim())){msg="\u624b\u673a\u53f7\u53ea\u80fd\u4e3a\u6570\u5b57\u3002";TB.app.login.Message.highlight(mobilePhone);TB.app.login.Message.show(msg);return false}if(textPhoneCode.value.trim()==""){TB.app.login.Message.highlight(textPhoneCode);if(msg==s){msg+="\u52a8\u6001\u5bc6\u7801";textPhoneCode.focus()}else{msg+="\u548c\u52a8\u6001\u5bc6\u7801"}}if(msg==s){TB.app.login.Message.hide();submitLoading(form);return true}else{TB.app.login.Message.show(msg);return false}},initialize:function(config){if(config){this.cfg=Util.merge(this.cfg,config)}longLogin();var instance=this;this._staticForm=get("J_StaticForm");this._dynamicForm=get("J_DynamicForm");this.safePluginSupport=TB.app.login.AliEdit.isSupportSafePlugin();this._pwdEdit=(function(){if(ie){return get("Password_Edit_IE")}else{return get("Password_Edit_NoIE")}})();if(this.safePluginSupport){Util.addEvent(this._pwdEdit,"keydown",function(e){if(e.keyCode==13){Util.preventEvent(e);if(instance._checkStaticForm()){instance._staticForm.submit()}}})}this._optionSafe=get("J_SafeLoginCheck");Util.addEvent(this._optionSafe,"click",function(){if(instance._optionSafe.checked){instance.switchToSafe()}else{instance._staticForm.elements.TPL_password.value="";instance.switchToStandard()}});setTimeout(function(){var checked=(typeof instance.cfg.useAliedit!=="undefined")?instance.cfg.useAliedit:instance.safePluginSupport;if(checked&&get("Password_Edit_IE")){instance._optionSafe.checked=true;instance.switchToSafe()}else{instance.switchToStandard()}},0);attachCapsLockTip(this._staticForm.elements.TPL_password,"J_CapsLockTip");Util.addEvent(this._staticForm,"submit",function(e){if(!instance._checkStaticForm()){Util.preventEvent(e)}});var self=this;Util.addEvent(Util.getElementsByClassName("J_Submit")[0],"click",function(e){if(self._safeMode){self.clearChromePwd();return true}});Util.addEvent(Util.getElementsByClassName("J_UserName")[0],"blur",function(e){if(self._safeMode){self.clearChromePwd()}});var sendCodeBtn=get("J_GetDynamicPwd");var countDown=function(){var time=300,countDownTip=get("J_DynamicCountDown"),countDownEl=countDownTip.getElementsByTagName("em")[0];countDownEl.innerHTML=time;sendCodeBtn.style.display="none";countDownTip.style.display="";var timer=setInterval(function(){time--;if(time===0){countDownTip.style.display="none";sendCodeBtn.style.display="";clearTimeout(timer)}else{countDownEl.innerHTML=time}},1000)};Util.addEvent(sendCodeBtn,"click",function(e){Util.preventEvent(e);Util.asyncRequest("post",instance.cfg.dynamicPasswordUrl+"?_input_charset=utf-8",{cache:false,success:function(data){var result=eval("("+data.responseText+")");if(result.success){TB.app.login.Message.show(result.reason,"dynamic");countDown()}else{TB.app.login.Message.show(result.reason)}}},Util.toParamString({nick:instance._dynamicForm.elements.TPL_username.value,mobile:instance._dynamicForm.elements.TPL_mobilephone.value}))});Util.addEvent(this._dynamicForm,"submit",function(e){if(!instance._checkDynamicForm()){Util.preventEvent(e)}});var toDynamicModel=function(){TB.app.login.Message.reset();setStyle("J_Static","display","none");setStyle("J_Dynamic","display","");setStyle("J_VisitorTips_1","display","none");setStyle("J_VisitorTips_2","display","block");instance._dynamicForm.elements.TPL_mobilephone.value="";instance._dynamicForm.elements.TPL_PhoneCode.value=""};var toStaticModel=function(){TB.app.login.Message.reset();setStyle("J_Dynamic","display","none");setStyle("J_Static","display","");setStyle("J_VisitorTips_1","display","block");setStyle("J_VisitorTips_2","display","none")};Util.onReady(function(){Util.addEvent("J_DynamicLink","click",function(e){Util.preventEvent(e);toDynamicModel()});Util.addEvent("J_StaticLink","click",function(e){Util.preventEvent(e);toStaticModel()});Util.addEvent("J_VisitorLink_1","click",function(e){Util.preventEvent(e);toDynamicModel()});Util.addEvent("J_VisitorLink_2","click",function(e){Util.preventEvent(e);toStaticModel()})})}};TB.app.login.PhoneCodePage={cfg:{dynamicPasswordUrl:"requestSecondPassword.do"},safePluginSupport:false,initialize:function(config){if(config){this.cfg=Util.merge(this.cfg,config)}longLogin();var instance=this;var form=get("J_MobileForm");this.safePluginSupport=TB.app.login.AliEdit.isSupportSafePlugin();if(this.safePluginSupport){var pwdEditTmp=(function(){if(ie){return get("Password_Edit_Tmp_IE")}else{return get("Password_Edit_Tmp_NoIE")}})();try{form.elements.tid.value=pwdEditTmp.ci1()}catch(err){}}var sendCodeBtn=get("J_GetPhoneCode");var countDown=function(){var time=60,countDownTip=get("J_PhoneCodeCountDown"),countDownEl=countDownTip.getElementsByTagName("em")[0];countDownEl.innerHTML=time;sendCodeBtn.style.display="none";countDownTip.style.display="";var timer=setInterval(function(){time--;if(time===0){countDownTip.style.display="none";sendCodeBtn.style.display="";clearTimeout(timer)}else{countDownEl.innerHTML=time}},1000)};Util.addEvent(sendCodeBtn,"click",function(e){Util.preventEvent(e);if(instance.safePluginSupport){Util.asyncRequest("post",instance.cfg.dynamicPasswordUrl+"?_input_charset=utf-8",{cache:false,success:function(data){var result=eval("("+data.responseText+")");if(result.success){TB.app.login.Message.show(result.reason,"dynamic");countDown()}else{TB.app.login.Message.show(result.reason)}}},Util.toParamString({userNumId:form.elements.unid.value,mobile:form.elements.TPL_mobilephone.value,tid:form.elements.tid.value,CtrlVersion:form.elements.CtrlVersion.value}))}else{TB.app.login.PluginPopup.show()}});Util.addEvent(form,"submit",function(e){TB.app.login.Message.clearHighlights();var textPhoneCode=form.elements.TPL_PhoneCode;if(textPhoneCode.value==""){Util.preventEvent(e);TB.app.login.Message.show("\u8bf7\u8f93\u5165\u60a8\u7684\u624b\u673a\u6821\u9a8c\u7801");TB.app.login.Message.highlight(textPhoneCode);textPhoneCode.focus()}else{TB.app.login.Message.hide();submitLoading(form)}})}};TB.app.login.AlipayPage={initialize:function(){var form=get("J_AlipayForm"),textUserName=form.elements.TPL_username,textPassword=form.elements.TPL_password,pwdEdit=(function(){if(ie){return get("Password_Edit_IE")}else{return get("Password_Edit_NoIE")}})(),pwdEditTmp=(function(){if(ie){return get("Password_Edit_Tmp_IE")}else{return get("Password_Edit_Tmp_NoIE")}})();try{pwdEditTmp.EchoTest();form.elements.tid.value=pwdEditTmp.ci1();this.safePluginSupport=true}catch(err){this.safePluginSupport=false}if(!this.safePluginSupport){get("J_InstallPlugin").style.display="";get("J_PasswordEdit").style.display="none"}Util.addEvent("J_InstallPlugin","click",function(e){Util.preventEvent(e);TB.app.login.PluginPopup.show()});var instance=this;Util.addEvent(form,"submit",function(e){TB.app.login.Message.clearHighlights();var s="\u8bf7\u8f93\u5165\u60a8\u7684",msg=s;if(instance.safePluginSupport){if(textUserName.value==""||textUserName.value==textUserName.title){msg+="\u8d26\u6237\u540d";TB.app.login.Message.highlight(textUserName);textUserName.focus()}textPassword.value=pwdEdit.TextData;if(textPassword.value==""){TB.app.login.Message.highlight(textPassword);if(msg==s){msg+="\u5bc6\u7801";try{textPassword.focus()}catch(e){}}else{msg+="\u548c\u5bc6\u7801"}}}else{msg="\u8bf7\u8f93\u5165\u5e10\u6237\u540d\u6216\u5bc6\u7801"}if(msg==s){TB.app.login.Message.hide();submitLoading(form)}else{Util.preventEvent(e);TB.app.login.Message.show(msg)}})}};Util.onReady(function(){setHash();Util.getElementsByClassName("J_UserName","input").forEach(function(textUserName){var inputHint=TB.widget.InputHint.decorate(textUserName);Util.addEvent(textUserName,"focus",function(){setTimeout(function(){textUserName.select()},0)});if(Util.hasClass(textUserName,"J_Focused")){inputHint.disappear()}else{textUserName.blur()}});if(ie6){Util.getElementsByClassName("J_Submit","button").forEach(function(btn){Util.addEvent(btn,"mouseover",function(){Util.addClass(btn,"hover")});Util.addEvent(btn,"mouseout",function(){Util.removeClass(btn,"hover")})})}Util.getElementsByClassName("J_CheckCode","input").forEach(function(input){Util.addEvent(input,"keyup",function(e){if(input.value){input.value=input.value.toUpperCase()}})});try{}catch(err){}});var longLogin=function(){Util.getElementsByClassName("long-login","span").forEach(function(span){Util.addEvent(span,"mouseover",function(){Util.addClass(span,"long-login-hover");var parent=span.parentNode;Util.getElementsByClassName("login-tips","",parent)[0].style.visibility="visible"});Util.addEvent(span,"mouseout",function(){Util.removeClass(span,"long-login-hover");var parent=span.parentNode;Util.getElementsByClassName("login-tips","",parent)[0].style.visibility="hidden"})});Util.getElementsByClassName("J_LognLoginInput","input").forEach(function(inputEl){Util.addEvent(inputEl,"click",function(){span=inputEl.parentNode;var parent=span.parentNode;if(!inputEl.checked){Util.addClass(span,"long-login-hover");Util.getElementsByClassName("login-tips","",parent)[0].style.visibility="visible";return}Util.removeClass(span,"long-login-hover");Util.getElementsByClassName("login-tips","",parent)[0].style.visibility="hidden"})})};TB.app.login.hiddenElements=function(arr){if((typeof(arr)).toString().toLowerCase()=="object"&&arr.length){for(var i=0,len=arr.length;i<len;i++){get(arr[i]).style.display="none"}return}if((typeof(arr)).toString().toLowerCase()=="string"){get(arr).style.display="none";return}}})();
